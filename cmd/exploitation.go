package cmd

import (
	"webhunter/internal/scanner"
	"webhunter/internal/utils"

	"github.com/spf13/cobra"
)

var (
	explPayloads []string
	explDryRun   bool
)

var exploitationCmd = &cobra.Command{
	Use:   "exploitation [targets]",
	Short: "Run exploitation modules",
	Long: `Execute specific payloads against targets to verify vulnerabilities.
Example: webhunter exploitation example.com --payload sqli --dry-run`,
	Args: cobra.MinimumNArgs(1),
	Run: func(cmd *cobra.Command, args []string) {
		cfg := scanner.Config{
			RateLimit: globalRate,
			Header:    globalHeader,
			DryRun:    explDryRun,
		}
		sc := scanner.New(cfg)
		
		utils.LogInfo("Starting Exploitation on %d targets", len(args))
		sc.Exploitation(args, explPayloads)
	},
}

func init() {
	rootCmd.AddCommand(exploitationCmd)
	exploitationCmd.Flags().StringSliceVar(&explPayloads, "payload", []string{}, "Payloads to use (sqli, xss, etc)")
	exploitationCmd.Flags().BoolVar(&explDryRun, "dry-run", false, "Simulate exploitation without sending harmful requests")
}
